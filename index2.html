<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lifting Simulator Calculator</title>
<style>
  body{font-family:Arial,sans-serif;background:#eef2f7;margin:0;padding:20px;display:flex;justify-content:center;}
  .container{max-width:900px;width:100%;background:white;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.15);padding:20px;}
  h2{text-align:center;margin-bottom:20px;}
  .row{margin-bottom:12px;}
  label{font-weight:700;display:block;margin-bottom:4px;}
  select,input{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;font-size:15px;}
  .options{display:flex;gap:10px;margin-top:10px;}
  .options label{display:flex;align-items:center;font-weight:700;}
  button{margin-top:12px;padding:10px 18px;font-size:18px;background:#007bff;color:white;border:none;border-radius:6px;cursor:pointer;}
  .results{margin-top:18px;padding:12px;background:#f8f9fa;border-radius:6px;border:1px solid #ccc;font-size:16px;}
</style>
</head>
<body>

<div class="container">
  <h2>üèã Lifting Simulator Calculator</h2>

  <div class="row">
    <label>Select Stage</label>
    <select id="stageSelect"></select>
  </div>

  <div class="row">
    <label>Search Weight</label>
    <input type="text" id="weightSearch" placeholder="Type weight name...">
  </div>

  <div class="options">
    <label><input type="checkbox" id="gpMuscle"> 2√ó Muscles</label>
    <label><input type="checkbox" id="gpCoins"> 2√ó Coins</label>
    <label><input type="checkbox" id="fast"> Faster Lifter</label>
  </div>

  <button onclick="calculate()">Calculate</button>

  <div class="results" id="resultBox">Fill inputs and press Calculate.</div>
</div>

<script>
const STAGES_URL = "https://liftingsimulatorcalculator.netlify.app/stages.json";
const WEIGHTS_URL = "https://liftingsimulatorcalculator.netlify.app/weights.json";

let stages = [];
let weights = [];

async function loadJSON(url) {
  const res = await fetch(url);
  if (!res.ok) throw new Error("Failed to load " + url);
  return await res.json();
}

function formatNum(n) {
  if (n >= 1e12) return (n/1e12).toFixed(2) + "T";
  if (n >= 1e9) return (n/1e9).toFixed(2) + "B";
  if (n >= 1e6) return (n/1e6).toFixed(2) + "M";
  if (n >= 1e3) return (n/1e3).toFixed(2) + "K";
  return n.toLocaleString();
}

function populateStages() {
  const sel = document.getElementById("stageSelect");
  sel.innerHTML = "";
  stages.forEach(s => {
    const opt = document.createElement("option");
    opt.value = s.n;
    opt.textContent = `Stage ${s.n} (x${s.m})`;
    sel.appendChild(opt);
  });
}

function calculate() {
  const stageN = Number(document.getElementById("stageSelect").value);
  const stage = stages.find(s => s.n === stageN);
  const search = document.getElementById("weightSearch").value.toLowerCase();
  const gpMuscle = document.getElementById("gpMuscle").checked;
  const gpCoins = document.getElementById("gpCoins").checked;
  const fast = document.getElementById("fast").checked;
  const resultBox = document.getElementById("resultBox");

  const weight = weights.find(w => w.stage === stage.n && w.name.toLowerCase().includes(search));
  if (!weight) {
    resultBox.textContent = "Weight not found for this stage.";
    return;
  }

  let baseGain = weight.gain * stage.m;
  if (gpMuscle) baseGain *= 2;

  let cps = 1;
  if (fast) cps *= 1.866;

  const musclesPerSec = baseGain * cps;
  const cost = weight.cost;
  const timeSec = cost / musclesPerSec;

  resultBox.innerHTML = `
Stage Multiplier: x${stage.m}<br>
Weight: <strong>${weight.name}</strong><br>
Weight Cost: <strong>${formatNum(cost)}</strong><br>
Gain per Lift: <strong>${formatNum(weight.gain)}</strong><br>
Muscles/sec: <strong>${formatNum(musclesPerSec)}</strong><br>
Time to reach: <strong>${(timeSec/60).toFixed(2)} minutes</strong><br>
2√ó Muscles: ${gpMuscle ? "Yes" : "No"}<br>
Faster Lifter: ${fast ? "Yes" : "No"}<br>
2√ó Coins Flag: ${gpCoins ? "Yes" : "No"} (not used in muscle calc)
  `;
}

(async function init() {
  try {
    stages = await loadJSON(STAGES_URL);
    weights = await loadJSON(WEIGHTS_URL);
    populateStages();
  } catch (e) {
    console.error(e);
    document.getElementById("resultBox").textContent = "Error loading data.";
  }
})();
</script>

</body>
</html>
